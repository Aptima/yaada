
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../tutorial/" rel="prev"/>
<link href="../openapi/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.8" name="generator"/>
<title>Python API - Yet Another Analytic Dataflow Architecture</title>
<link href="../assets/stylesheets/main.ded33207.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../assets/_mkdocstrings.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#yaada-python-api">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Yet Another Analytic Dataflow Architecture" class="md-header__button md-logo" data-md-component="logo" href=".." title="Yet Another Analytic Dataflow Architecture">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Yet Another Analytic Dataflow Architecture
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Python API
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Yet Another Analytic Dataflow Architecture" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Yet Another Analytic Dataflow Architecture">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Yet Another Analytic Dataflow Architecture
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../getting-started/">
        Getting Started
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../concepts/">
        Architecture and Concepts
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tutorial/">
        Tutorial
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Python API
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Python API
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#analytic-context">
    Analytic Context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context">
    yaada.core.analytic.context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext">
    AnalyticContext
  </a>
<nav aria-label="AnalyticContext" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.aggregation">
    aggregation()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.async_exec_analytic">
    async_exec_analytic()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.delete">
    delete()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.delete_by_query">
    delete_by_query()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.delete_index">
    delete_index()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.document_counts">
    document_counts()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.document_mappings">
    document_mappings()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.document_type_exists">
    document_type_exists()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.exists">
    exists()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.get">
    get()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.index_field_mappings">
    index_field_mappings()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.index_mappings">
    index_mappings()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.index_settings">
    index_settings()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.ingest_barrier">
    ingest_barrier()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.mget">
    mget()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.query">
    query()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.rawquery">
    rawquery()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.report_status">
    report_status()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.sentinel_present">
    sentinel_present()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.set_analytic_name">
    set_analytic_name()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.set_analytic_session_id">
    set_analytic_session_id()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.sync_exec_analytic">
    sync_exec_analytic()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.term_counts">
    term_counts()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.update">
    update()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.make_analytic_context">
    make_analytic_context()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../openapi/">
        REST API
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#analytic-context">
    Analytic Context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context">
    yaada.core.analytic.context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext">
    AnalyticContext
  </a>
<nav aria-label="AnalyticContext" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.aggregation">
    aggregation()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.async_exec_analytic">
    async_exec_analytic()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.delete">
    delete()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.delete_by_query">
    delete_by_query()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.delete_index">
    delete_index()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.document_counts">
    document_counts()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.document_mappings">
    document_mappings()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.document_type_exists">
    document_type_exists()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.exists">
    exists()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.get">
    get()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.index_field_mappings">
    index_field_mappings()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.index_mappings">
    index_mappings()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.index_settings">
    index_settings()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.ingest_barrier">
    ingest_barrier()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.mget">
    mget()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.query">
    query()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.rawquery">
    rawquery()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.report_status">
    report_status()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.sentinel_present">
    sentinel_present()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.set_analytic_name">
    set_analytic_name()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.set_analytic_session_id">
    set_analytic_session_id()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.sync_exec_analytic">
    sync_exec_analytic()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.term_counts">
    term_counts()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.AnalyticContext.update">
    update()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#yaada.core.analytic.context.make_analytic_context">
    make_analytic_context()
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="yaada-python-api">YAADA Python API</h1>
<h2 id="analytic-context">Analytic Context</h2>
<div class="doc doc-object doc-module">
<a id="yaada.core.analytic.context"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext">
<code>AnalyticContext</code>
</h2>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AnalyticContext</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">analytic_name</span><span class="p">,</span>
        <span class="n">analytic_session_id</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="n">msg_service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">doc_service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ob_service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">model_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">schema_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">connect_to_services</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">overrides</span><span class="o">=</span><span class="p">{},</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">"config"</span> <span class="ow">in</span> <span class="n">overrides</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">YAADAConfig</span><span class="p">(</span><span class="n">overrides</span><span class="p">[</span><span class="s2">"config"</span><span class="p">],</span> <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">YAADAConfig</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema_manager</span> <span class="o">=</span> <span class="n">schema_manager</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schema_manager</span> <span class="o">=</span> <span class="n">SchemaManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span> <span class="o">=</span> <span class="n">analytic_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span> <span class="o">=</span> <span class="n">analytic_session_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">analytic_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span><span class="p">,</span>
            <span class="n">analytic_session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span><span class="p">,</span>
            <span class="n">started</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">finished</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">input_stats</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">output_stats</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_document_pipeline</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_flush</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overrides</span> <span class="o">=</span> <span class="n">overrides</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span> <span class="o">=</span> <span class="n">msg_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span> <span class="o">=</span> <span class="n">doc_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span> <span class="o">=</span> <span class="n">ob_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="n">model_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_in_status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">migration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connect_to_services</span> <span class="o">=</span> <span class="n">connect_to_services</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connect_to_services</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span> <span class="o">=</span> <span class="n">make_message_service</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"analytic-context-</span><span class="si">{</span><span class="n">analytic_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">analytic_session_id</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span> <span class="o">=</span> <span class="n">make_document_service</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span> <span class="o">=</span> <span class="n">make_objectstorage_service</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span> <span class="o">=</span> <span class="n">make_model_manager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">set_analytic</span><span class="p">(</span><span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">)</span>

        <span class="n">register_context_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wait_for_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document_counts</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&gt;=</span> <span class="n">timeout</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="s2">"waited too long for analytic context"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_analytic_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analytic_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Assigns an ``analytic_name`` value of a context object.</span>

<span class="sd">        Parameters:</span>

<span class="sd">        * **analytic_name: str**</span>

<span class="sd">          A description of the analytic's purpose</span>

<span class="sd">        Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            context.set_analytic_name("jupyter")</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span> <span class="o">=</span> <span class="n">analytic_name</span>
        <span class="c1"># self.status['analytic_name'] = analytic_name</span>

    <span class="k">def</span> <span class="nf">set_analytic_session_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Assigns an ``analytic_session_id`` value of a context object.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **analytic_session_id: str**</span>

<span class="sd">            An identifier for this analytic object</span>

<span class="sd">        Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            context.set_analytic_session_id("Query Data")</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span> <span class="o">=</span> <span class="n">analytic_session_id</span>
        <span class="c1"># self.status['analytic_session_id'] = analytic_session_id</span>

    <span class="k">def</span> <span class="nf">create_derived_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">AnalyticContext</span><span class="p">(</span>
            <span class="n">analytic_name</span><span class="o">=</span><span class="n">analytic_name</span><span class="p">,</span>
            <span class="n">analytic_session_id</span><span class="o">=</span><span class="n">analytic_session_id</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">msg_service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="p">,</span>
            <span class="n">doc_service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="p">,</span>
            <span class="n">ob_service</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span><span class="p">,</span>
            <span class="n">model_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="n">schema_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schema_manager</span><span class="p">,</span>
            <span class="n">connect_to_services</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_connect_to_services</span><span class="p">,</span>
            <span class="n">overrides</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overrides</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"parent"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">analytic_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span><span class="p">,</span>
            <span class="n">analytic_session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">include_results_in_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_in_status</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_in_status</span> <span class="o">=</span> <span class="n">results_in_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># self.status['results'] = list()</span>

    <span class="k">def</span> <span class="nf">init_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_document_pipeline</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_derived_context</span><span class="p">(</span><span class="s2">"pipeline"</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">document_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_document_pipeline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">analytic</span><span class="o">.</span><span class="n">find_and_register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">pipelines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_document_pipeline</span>

    <span class="k">def</span> <span class="nf">result_sync</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">,</span>
        <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">upsert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">archive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">barrier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">barrier_timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">raise_ingest_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">barrier</span><span class="p">:</span>
            <span class="n">sentinel_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sentinel_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">utility</span><span class="o">.</span><span class="n">batched_generator</span><span class="p">(</span>
            <span class="n">apply_barrier_sentinel_generator</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="s2">"_ingest_sentinel"</span><span class="p">,</span> <span class="n">sentinel_value</span><span class="p">),</span>
            <span class="mi">1000</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># each batch is fully realized and has sentinel applied if necessary</span>
            <span class="n">doc_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">batch_to_store</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">prepare_doc_for_insert</span><span class="p">(</span>
                    <span class="n">doc</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span><span class="p">,</span>
                    <span class="n">upsert</span><span class="p">,</span>
                    <span class="n">archive</span><span class="o">=</span><span class="n">archive</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">process</span><span class="p">:</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_pipeline</span><span class="o">.</span><span class="n">process_document</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">schema_manager</span><span class="o">.</span><span class="n">validate_document</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">jsonschema</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">write_ingest_error</span><span class="p">(</span>
                            <span class="s2">"jsonschema"</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">raise_ingest_error</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">e</span>
                        <span class="k">continue</span>

                <span class="n">batch_to_store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                <span class="n">doc_dict</span><span class="p">[(</span><span class="n">doc</span><span class="p">[</span><span class="s2">"doc_type"</span><span class="p">],</span> <span class="n">doc</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">])]</span> <span class="o">=</span> <span class="n">doc</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_count_result</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s2">"doc_type"</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_in_status</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            <span class="n">docs_flushed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">store_batch</span><span class="p">(</span>
                <span class="n">batch_to_store</span><span class="p">,</span> <span class="n">raise_ingest_error</span><span class="o">=</span><span class="n">raise_ingest_error</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">_id</span> <span class="ow">in</span> <span class="n">docs_flushed</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">_id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">doc_dict</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">publish_sinklog</span><span class="p">(</span><span class="n">doc_dict</span><span class="p">[(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">_id</span><span class="p">)])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span><span class="n">_id</span><span class="p">)</span><span class="si">}</span><span class="s2"> not found in doc_dict </span><span class="si">{</span><span class="n">doc_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">barrier</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">_id</span> <span class="ow">in</span> <span class="n">docs_flushed</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ingest_barrier</span><span class="p">(</span>
                        <span class="n">doc_type</span><span class="p">,</span>
                        <span class="n">_id</span><span class="p">,</span>
                        <span class="n">barrier_timeout</span><span class="p">,</span>
                        <span class="s2">"_ingest_sentinel"</span><span class="p">,</span>
                        <span class="n">sentinel_value</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">result_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">,</span>
        <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">upsert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">archive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">barrier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">barrier_timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">raise_ingest_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">docs_to_wait_for</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">barrier</span><span class="p">:</span>
            <span class="n">sentinel_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sentinel_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">apply_barrier_sentinel_generator</span><span class="p">(</span>
            <span class="n">docs</span><span class="p">,</span> <span class="s2">"_ingest_sentinel"</span><span class="p">,</span> <span class="n">sentinel_value</span>
        <span class="p">):</span>  <span class="c1"># sentinel value is only applied if sentinel_value is non-None</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">prepare_doc_for_insert</span><span class="p">(</span>
                <span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span><span class="p">,</span> <span class="n">upsert</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">schema_manager</span><span class="o">.</span><span class="n">validate_document</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">schema_manager</span><span class="o">.</span><span class="n">validate_document</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">jsonschema</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">write_ingest_error</span><span class="p">(</span>
                        <span class="s2">"jsonschema"</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">raise_ingest_error</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">e</span>
            <span class="k">if</span> <span class="n">barrier</span><span class="p">:</span>
                <span class="n">docs_to_wait_for</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">doc</span><span class="p">[</span><span class="s2">"doc_type"</span><span class="p">],</span> <span class="n">doc</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">process</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">publish_ingest</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">publish_sink</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_count_result</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s2">"doc_type"</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_in_status</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">barrier</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">_id</span> <span class="ow">in</span> <span class="n">docs_to_wait_for</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ingest_barrier</span><span class="p">(</span>
                    <span class="n">doc_type</span><span class="p">,</span> <span class="n">_id</span><span class="p">,</span> <span class="n">barrier_timeout</span><span class="p">,</span> <span class="s2">"_ingest_sentinel"</span><span class="p">,</span> <span class="n">sentinel_value</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">,</span>
        <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">upsert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">archive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">barrier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">barrier_timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">raise_ingest_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">docs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">utility</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>
            <span class="n">_docs</span> <span class="o">=</span> <span class="n">docs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">docs</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sync</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_sync</span><span class="p">(</span>
                <span class="n">docs</span><span class="o">=</span><span class="n">_docs</span><span class="p">,</span>
                <span class="n">process</span><span class="o">=</span><span class="n">process</span><span class="p">,</span>
                <span class="n">upsert</span><span class="o">=</span><span class="n">upsert</span><span class="p">,</span>
                <span class="n">archive</span><span class="o">=</span><span class="n">archive</span><span class="p">,</span>
                <span class="n">raise_ingest_error</span><span class="o">=</span><span class="n">raise_ingest_error</span><span class="p">,</span>
                <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span>
                <span class="n">refresh</span><span class="o">=</span><span class="n">barrier</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_async</span><span class="p">(</span>
                <span class="n">docs</span><span class="o">=</span><span class="n">_docs</span><span class="p">,</span>
                <span class="n">process</span><span class="o">=</span><span class="n">process</span><span class="p">,</span>
                <span class="n">upsert</span><span class="o">=</span><span class="n">upsert</span><span class="p">,</span>
                <span class="n">archive</span><span class="o">=</span><span class="n">archive</span><span class="p">,</span>
                <span class="n">barrier</span><span class="o">=</span><span class="n">barrier</span><span class="p">,</span>
                <span class="n">barrier_timeout</span><span class="o">=</span><span class="n">barrier_timeout</span><span class="p">,</span>
                <span class="n">raise_ingest_error</span><span class="o">=</span><span class="n">raise_ingest_error</span><span class="p">,</span>
                <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_status</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">doc</span><span class="p">,</span>
        <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">archive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">barrier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">barrier_timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">raise_ingest_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>

<span class="sd">        Stores the document given by the ``doc`` parameter in Elasticsearch.</span>

<span class="sd">          Parameters:</span>

<span class="sd">          * **doc: dict, list[dict]**</span>

<span class="sd">            The ``doc`` parameter, represents an Elasticsearch document to be ingested. The schema and details of a document can be found in :ref:`Documents`.</span>

<span class="sd">            This parameter can be given as a dictionary representation of an Elasticsearch document, or a list of ``doc``'s which will result in a batch-ingest.</span>

<span class="sd">          * **process: bool, default = True**</span>

<span class="sd">            optional</span>

<span class="sd">            If ``True``, the update process with run through the ingest pipeline</span>

<span class="sd">          * **sync: bool, default = True**</span>

<span class="sd">            optional</span>

<span class="sd">            If value is set to ``True``, the process will be run synchronously, if set to ``False``, it will run asynchronously.</span>

<span class="sd">          * **archive: bool, default = False**</span>

<span class="sd">            optional</span>

<span class="sd">            If the document or documents being ingested are from an archive, this parameter's value should be set</span>
<span class="sd">            to ``True``. Otherwise, it will default to ``False``.</span>

<span class="sd">            When ``False``, a document being ingested through the ``update`` function will be automtically set a timestamp value</span>
<span class="sd">            to the field ``@timestamp`` to the same time that it was ingested. When ``True``, because the document is from an archive,</span>
<span class="sd">            the ``@timestamp`` field will already exists and will not be reassigned. Therefore, it will keep it's value representing the time</span>
<span class="sd">            when it was originally ingested.</span>

<span class="sd">          * **barrier: bool, default=False**</span>

<span class="sd">            optional</span>

<span class="sd">            Setting ``barrier`` to ``True`` ensures that the document is indexed Elasticsearch</span>
<span class="sd">            and searchable before the the update function finishes running.</span>

<span class="sd">            Enabling ``barrier`` will dractically reduce throughput performace especially if ``update``</span>
<span class="sd">            is being called repeatedly by updating one document at a time. The process will not be slowed</span>
<span class="sd">            drastically if the ``update`` is run as a batch-ingest.</span>

<span class="sd">          * **barrier_timeout: int, default=600**</span>

<span class="sd">            optional</span>

<span class="sd">            This value is the maximum amount of time in seconds that the function will wait</span>
<span class="sd">            for the document to appear in Elasticsearch before finishing. If this maximum value</span>
<span class="sd">            is reached and the document is not in elastic search, it will return an</span>
<span class="sd">            ``IngestBarrierTimeout`` error. This only applies if the ``barrier`` parameter is set</span>
<span class="sd">            to ``True``.</span>

<span class="sd">          * **raise_ingest_error: bool, default=True**</span>

<span class="sd">            optional</span>


<span class="sd">        Short example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">          doc = {</span>
<span class="sd">              _id = "123",</span>
<span class="sd">              doc_type = "EmployeeSurvey",</span>
<span class="sd">              favorite_color = "red",</span>
<span class="sd">              favoite_number = 4</span>
<span class="sd">          }</span>
<span class="sd">          context.update(doc)</span>


<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">(</span>
            <span class="n">doc</span><span class="p">,</span>
            <span class="n">process</span><span class="o">=</span><span class="n">process</span><span class="p">,</span>
            <span class="n">sync</span><span class="o">=</span><span class="n">sync</span><span class="p">,</span>
            <span class="n">upsert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">archive</span><span class="o">=</span><span class="n">archive</span><span class="p">,</span>
            <span class="n">barrier</span><span class="o">=</span><span class="n">barrier</span><span class="p">,</span>
            <span class="n">barrier_timeout</span><span class="o">=</span><span class="n">barrier_timeout</span><span class="p">,</span>
            <span class="n">raise_ingest_error</span><span class="o">=</span><span class="n">raise_ingest_error</span><span class="p">,</span>
            <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_count_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">doc_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"output_stats"</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"output_stats"</span><span class="p">][</span><span class="n">doc_type</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"output_stats"</span><span class="p">][</span><span class="n">doc_type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_count_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">doc_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"input_stats"</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"input_stats"</span><span class="p">][</span><span class="n">doc_type</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"input_stats"</span><span class="p">][</span><span class="n">doc_type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">report_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write_es</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Called automatically when analytics are started and finishing. Available to be called by Anaytic developers</span>
<span class="sd">        to show intermediate status of a an analytic. To do this, call it in the ``run`` function of an Analytic.</span>

<span class="sd">          Parameters:</span>

<span class="sd">          * **write_es:bool, default=False**</span>



<span class="sd">          * **message:str, default=None**</span>

<span class="sd">            A string value containing the message to display.</span>

<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"@timestamp"</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"analytic_compute_duration_seconds"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>
        <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"message"</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_printer</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">publish_analytic_status</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">write_es</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">write_analytic_status</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_started</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"input_stats"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"output_stats"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"error"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"message"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"analytic_finish_time"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"finished"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"analytic_compute_duration_seconds"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"started"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"analytic_start_time"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_status</span><span class="p">(</span><span class="n">write_es</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finish_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"analytic_finish_time"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finish_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"finished"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"analytic_compute_duration_seconds"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finish_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>
        <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_status</span><span class="p">(</span><span class="n">write_es</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"error"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"message"</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_status</span><span class="p">(</span><span class="n">write_es</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">doc_type</span><span class="p">,</span>
        <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}},</span>
        <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">scroll_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">scroll</span><span class="o">=</span><span class="s2">"2m"</span><span class="p">,</span>
        <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns results of a query to Elasticsearch as a generator object. It uses an abstraction of the `scroll API &lt;https://www.elastic.co/guide/en/elasticsearch/reference/7.9/scroll-api.html&gt;`_.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            This represents an Elasticsearch index. The query will search the index.</span>

<span class="sd">            Every document in Elasticsearch has a required ``doc_type`` field as described in the :ref:`Documents` section.</span>

<span class="sd">          * **query: dict, default={"query": {"match_all": {}}}**</span>

<span class="sd">            optional</span>

<span class="sd">            An Elasticsearch query. More info can be found in `Elasticsearch documentation.</span>
<span class="sd">            &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html&gt;`_</span>
<span class="sd">          * **size:int, default=None**</span>

<span class="sd">            optional</span>

<span class="sd">            Specifies number of documents to be returned. If the value is greater than the</span>
<span class="sd">            resulting number of documents, the resulting documents will all be returned.</span>
<span class="sd">          * **scroll_size:int, defaults=1000**</span>

<span class="sd">            optional</span>

<span class="sd">          * **scroll:str, default='2m'**</span>

<span class="sd">            optional</span>

<span class="sd">          * **raw:bool, default=False**</span>

<span class="sd">            optional</span>

<span class="sd">          * **source:list, default=None**</span>

<span class="sd">            optional</span>

<span class="sd">            A list of fields that will be shown for each document returned by the query. Used to limit the fields that each document will return.</span>
<span class="sd">            Must include ``_id`` and ``doc_type``.</span>

<span class="sd">        """</span>

        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">"_source"</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scroll_size</span><span class="o">=</span><span class="n">scroll_size</span><span class="p">,</span> <span class="n">scroll</span><span class="o">=</span><span class="n">scroll</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_count_input</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">"doc_type"</span><span class="p">])</span>
            <span class="k">yield</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_status</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">paged_query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">doc_type</span><span class="p">,</span>
        <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}},</span>
        <span class="n">page_from</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">source_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">source_include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">paged_query</span><span class="p">(</span>
            <span class="n">doc_type</span><span class="o">=</span><span class="n">doc_type</span><span class="p">,</span>
            <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
            <span class="n">page_from</span><span class="o">=</span><span class="n">page_from</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
            <span class="n">_source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
            <span class="n">_source_exclude</span><span class="o">=</span><span class="n">source_exclude</span><span class="p">,</span>
            <span class="n">_source_include</span><span class="o">=</span><span class="n">source_include</span><span class="p">,</span>
            <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">query_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}):</span>

        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">query_count</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">doc_type</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">source_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">source_include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">sentinel_key</span><span class="o">=</span><span class="s2">"_ingest_sentinel"</span><span class="p">,</span>
        <span class="n">sentinel_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns a document from Elasticsearch.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            The document type of the desired document.</span>

<span class="sd">          * **id: str**</span>

<span class="sd">            The identifier of a single document.</span>

<span class="sd">          * **source: list, defult=None**</span>

<span class="sd">            optional</span>

<span class="sd">            A list containing the fields that will be returned for the document. Must include ``_id`` and ``doc_type``.</span>

<span class="sd">          * **source_exclude:list, default=None**</span>

<span class="sd">            optional</span>

<span class="sd">            A list containing the fields that will be excluded from what is returned for the document.</span>

<span class="sd">          * **source_include:list, default=None**</span>

<span class="sd">            optional</span>

<span class="sd">            A list containing the fields that will returned for the document.</span>

<span class="sd">          * **wait:bool, default=False**</span>

<span class="sd">            optional</span>


<span class="sd">            If True, this function will wait to return until the document is searchable in Elasticsearch.</span>

<span class="sd">          * **timeout:int, default=60**</span>

<span class="sd">            optional</span>

<span class="sd">            This specifies the maximum time to wait for the document to be searchable in Elasticsearch if the ``wait`` parameter is set to ``True``.</span>

<span class="sd">          * **sentinel_key:str, default='_ingest_sentinel'**</span>

<span class="sd">            optional</span>

<span class="sd">            Advance Usage</span>

<span class="sd">            Elasticsearch field that contains the ``sentinel_value``. By default, there will be an ``_ingest_sentinal`` Elasticsearch field.</span>


<span class="sd">            This parameter relates to the ``barrier`` concept used as a parameter in the :py:meth:`yaada.analytic.context.AnalyticContext.update` method.</span>
<span class="sd">            If this ``get`` method is being used to retrieve a document in Elasticsearch soon after it has been ingested, this can be used to wait until</span>
<span class="sd">            that value is searchable in Elasticsearch before it is retrieved. This parameter will only be applied if the ``wait`` parameter</span>
<span class="sd">            is set to ``True``.</span>

<span class="sd">          * **sentinel_value:str, default=None**</span>

<span class="sd">            optional</span>

<span class="sd">            Advance Usage</span>

<span class="sd">            This parameter is used to ensure that an updated document has fully updated in Elasticsearch before it is retrieved by the ``get`` method. Because a</span>
<span class="sd">            document that is being updated may already exist, YAADA needs a way to know that it has been updated before retrieving the document.</span>
<span class="sd">            This is done by introducing a new value to the document, called a sentinal value. If a value is specified for this parameter, YAADA will</span>
<span class="sd">            check that this value matches up with the value in the ``sentinel_key`` field for the document before retrieving it, to know that it has been updated.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">          context.get("Publication", "2cf0d07c-cba9-47e3-9063-5d6265e26089")</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ingest_barrier</span><span class="p">(</span>
                <span class="n">doc_type</span><span class="p">,</span>
                <span class="nb">id</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                <span class="n">sentinel_key</span><span class="o">=</span><span class="n">sentinel_key</span><span class="p">,</span>
                <span class="n">sentinel_value</span><span class="o">=</span><span class="n">sentinel_value</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">doc_type</span><span class="p">,</span>
            <span class="nb">id</span><span class="p">,</span>
            <span class="n">_source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
            <span class="n">_source_exclude</span><span class="o">=</span><span class="n">source_exclude</span><span class="p">,</span>
            <span class="n">_source_include</span><span class="o">=</span><span class="n">source_include</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns a bool value describing whether or not a document exists.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">              The document type.</span>
<span class="sd">          * **id: str**</span>

<span class="sd">              The unique id of the document</span>


<span class="sd">        Example</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">          context.exists("Publication", "f33bca95-3caa-46ac-8667-448ba4973190")</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mget</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_include</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns multiple documents from Elasticsearch.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            The document type of the documents to be returned.</span>

<span class="sd">          * **ids: list**</span>

<span class="sd">            List of unique identifiers of documents in Elasticsearch</span>

<span class="sd">          * **source: list, defult=None**</span>

<span class="sd">            optional</span>

<span class="sd">            A list containing the fields that will be returned for the document.</span>

<span class="sd">          * **source_exclude, default=None**</span>

<span class="sd">            optional</span>

<span class="sd">            A list containing the fields that will be excluded from what is returned for the document.</span>

<span class="sd">          * **source_include, default=None**</span>

<span class="sd">            optional</span>

<span class="sd">            A list containing the fields that will returned for the document.</span>


<span class="sd">        Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">          context.mget("Publication", ["2cf0d07c-cba9-47e3-9063-5d6265e26089", "b0e062ac-0e84-40db-8ecd-36e1aa0e264b"])</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">mget</span><span class="p">(</span>
            <span class="n">doc_type</span><span class="p">,</span>
            <span class="n">ids</span><span class="p">,</span>
            <span class="n">_source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
            <span class="n">_source_exclude</span><span class="o">=</span><span class="n">source_exclude</span><span class="p">,</span>
            <span class="n">_source_include</span><span class="o">=</span><span class="n">source_include</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_by_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Delete all documents that result from the a given query.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            The document type.</span>

<span class="sd">          * **query: dict**</span>

<span class="sd">            And Elasticsearch query. Elasticsearch's documentation on querying can be found `here</span>
<span class="sd">            &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html&gt;`_.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">          context.delete_by_query("Publication", {</span>
<span class="sd">              'query': {</span>
<span class="sd">                  'match': {</span>
<span class="sd">                      '_id': '2cf0d07c-cba9-47e3-9063-5d6265e26089'</span>
<span class="sd">                  }</span>
<span class="sd">              }</span>
<span class="sd">          })</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">delete_by_query</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Delete a single document in Elasticsearch.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            The document type of the documents to be returned.</span>

<span class="sd">          * **id: str**</span>

<span class="sd">            Identifier of document in Elasticsearch.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            context.delete("Publication", "b0e062ac-0e84-40db-8ecd-36e1aa0e264b")</span>

<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">initialize_index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Deletes an index in Elasticsearch.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            Documents with this ``doc_type`` will all be deleted.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">          context.delete_index("Publication")</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">delete_index</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">initialize_index</span><span class="o">=</span><span class="n">initialize_index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_model_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">modelservice</span><span class="o">.</span><span class="n">save_model_instance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"model_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"model_instance_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_instance_id</span>

    <span class="k">def</span> <span class="nf">load_model_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_instance_id</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">modelservice</span><span class="o">.</span><span class="n">load_model_instance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_instance_id</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"model_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"model_instance_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_instance_id</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span> <span class="nf">sentinel_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">sentinel_key</span><span class="p">,</span> <span class="n">sentinel_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""check if a document is searchable with a given sentinel value."""</span>
        <span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="n">doc_type</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"bool"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">"must"</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span><span class="s2">"term"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="nb">id</span><span class="p">}},</span>
                                <span class="p">{</span><span class="s2">"term"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">sentinel_key</span><span class="si">}</span><span class="s2">.keyword"</span><span class="p">:</span> <span class="n">sentinel_value</span><span class="p">}},</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sentinel_key</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doc</span><span class="p">[</span><span class="n">sentinel_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">sentinel_value</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">ingest_barrier</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">doc_type</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">sentinel_key</span><span class="o">=</span><span class="s2">"_ingest_sentinel"</span><span class="p">,</span>
        <span class="n">sentinel_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Describe sentinal key and value here so that it can be refered to.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc_type ([type]): [description]</span>
<span class="sd">            id ([type]): [description]</span>
<span class="sd">            timeout (int, optional): [description]. Defaults to 60.</span>
<span class="sd">            sentinel_key (str, optional): [description]. Defaults to '_ingest_sentinel'.</span>
<span class="sd">            sentinel_value ([type], optional): [description]. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            IngestBarrierTimeout: [description]</span>
<span class="sd">        """</span>
        <span class="n">delays</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">elapsed</span> <span class="o">&gt;=</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">IngestBarrierTimeout</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"timeout of </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> reached and </span><span class="si">{</span><span class="n">doc_type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> not found in total of </span><span class="si">{</span><span class="n">elapsed</span><span class="si">}</span><span class="s2"> seconds"</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">delays</span><span class="p">:</span>
                <span class="n">delay</span> <span class="o">=</span> <span class="n">delays</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">timeout</span> <span class="o">-</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="n">delay</span><span class="p">:</span>
                <span class="n">delay</span> <span class="o">=</span> <span class="n">timeout</span> <span class="o">-</span> <span class="n">elapsed</span>
            <span class="k">if</span> <span class="n">delay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># print(f"trying in {delay} seconds")</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sentinel_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentinel_present</span><span class="p">(</span>
                    <span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">sentinel_key</span><span class="p">,</span> <span class="n">sentinel_value</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">invalidate_model_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_instance_id</span><span class="p">):</span>
        <span class="n">modelservice</span><span class="o">.</span><span class="n">invalidate_model_instance</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model_instance_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">document_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns an object with a breakdown of each index and the count of documents</span>
<span class="sd">        in each index. The keys are each ``doc_type``'s in Elasticsearch and the values are</span>
<span class="sd">        the number of documents currently stored.</span>

<span class="sd">        Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            context.document_counts()</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">document_counts</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">term_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}):</span>
<span class="w">        </span><span class="sd">"""</span>

<span class="sd">        Returns an object describing the frequency of terms for a given field of an index by running an Elasticsearch terms aggregation.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            The document type, this represents an Elasticsearch index.</span>

<span class="sd">          * **term: str**</span>

<span class="sd">            The field that will be inspected.</span>

<span class="sd">          * **query: dict, default={"query":{"match_all":{}}}**</span>

<span class="sd">            optional</span>

<span class="sd">            Provides a filter for the documents that will be aggregated.</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">term_counts</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">document_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        This is a depricated method, use :py:meth:`yaada.analytic.context.AnalyticContext.index_field_mappings` instead.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">index_field_mappings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">index_field_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">):</span>
        <span class="c1"># Link out specific Elasticsearch call</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns the Elasticsearch mapping for the given ``doc_type``. The Elasticsearch documentation</span>
<span class="sd">        has a section on `mappings. &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html&gt;`_</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            The document type, this represents an Elasticsearch index.</span>

<span class="sd">          * **fields: str **</span>

<span class="sd">            optional</span>

<span class="sd">            Limits the mapping to fields given for this parameter. Wildcards can be used.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">index_field_mappings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">index_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns raw index mapping for an Elasticsearch index. Includes Elasticsearch metadata that :py:meth:`yaada.analytic.context.AnalyticContext.index_field_mappings` does not.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            The document type, this represents an Elasticsearch index.</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">index_mappings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">index_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns an object with an index's Elasticsearch settings. `Documentation on Elasticsearch's settings &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#index-modules-settings&gt;`_</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            The document type, this represents an Elasticsearch index.</span>


<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">index_settings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">{},</span> <span class="n">mappings</span><span class="o">=</span><span class="p">{},</span> <span class="n">aliases</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">init_index</span><span class="p">(</span>
            <span class="n">doc_type</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span> <span class="n">mappings</span><span class="o">=</span><span class="n">mappings</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">aliases</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">aggregation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Depricated, use :py:meth:`yaada.analytic.context.AnalyticContext.rawquery` instead.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">rawquery</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rawquery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns results to a query.</span>

<span class="sd">        This returns the bare elasticsearch results. Use this to access to the scoring information or aggregations.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type: str**</span>

<span class="sd">            The document type, this represents an Elasticsearch index.</span>

<span class="sd">          * **query: dict**</span>

<span class="sd">            Elasticsearch query, more documentation can be found `here &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html&gt;`_.</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">rawquery</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">document_type_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns a bool value describing whether a ``doc_type``</span>
<span class="sd">        exists.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **doc_type:str**</span>

<span class="sd">            The document type, this represents an Elasticsearch index.</span>

<span class="sd">        Example:</span>

<span class="sd">         .. code-block:: python</span>

<span class="sd">            context.document_type_exists("Publication")</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">document_type_exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">query_hit_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">q</span><span class="p">[</span><span class="s2">"size"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">aggregation</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"hits"</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"total"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">sync_exec_analytic</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">analytic_name</span><span class="p">,</span>
        <span class="n">analytic_session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">include_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">printer</span><span class="o">=</span><span class="nb">print</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Synchronously run an analytic. A tutorial on writing and running yaada analytics can be found in the :ref:`Writing an Analytic&lt;Writing an Analytic&gt;` section.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **analytic_name: str**</span>

<span class="sd">            The full analytic class name.</span>

<span class="sd">          * **analytic_session_id: str, default=None**</span>

<span class="sd">            optional</span>

<span class="sd">            This value will be stored in Elasticsearch to mark the documents changed by this analytic session.</span>
<span class="sd">            If a value is not defined, the context object's ``analytic_session_id`` value will be automatically assigned.</span>

<span class="sd">          * **parameters: dict, default={}**</span>

<span class="sd">            optional</span>

<span class="sd">            This value corresponds to the parameters of the yaada analytic being run.</span>

<span class="sd">            The parameters are assigned by setting each key in this dict to a string</span>
<span class="sd">            of the name of a parameter. The parameter will be assinged to the value given in the key-value pair.</span>

<span class="sd">          * **include_results: bool, default=False**</span>

<span class="sd">            If running an analytic synchronously, setting this to  ``True`` will return the produced documents from the analytic.</span>

<span class="sd">            Warning - Will Produce a Large Output</span>

<span class="sd">            optional</span>

<span class="sd">          * **printer: function, default=print**</span>

<span class="sd">            optional</span>

<span class="sd">            Advanced Usage, Experimental API subject to change, not recommended for users</span>

<span class="sd">        Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">          context.sync_exec_analytic(</span>
<span class="sd">              analytic_name="yaada.analytic.builtin.newspaper.NewspaperScrapeSources",</span>
<span class="sd">              parameters={"content":True,"scrape_top_image":False,"memoize":True})</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">analytic_session_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">analytic_session_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_derived_context</span><span class="p">(</span><span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sync_exec_analytic</span><span class="p">(</span>
            <span class="n">c</span><span class="p">,</span>
            <span class="n">analytic_name</span><span class="p">,</span>
            <span class="n">analytic_session_id</span><span class="p">,</span>
            <span class="n">parameters</span><span class="p">,</span>
            <span class="n">include_results</span><span class="o">=</span><span class="n">include_results</span><span class="p">,</span>
            <span class="n">printer</span><span class="o">=</span><span class="n">printer</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">async_exec_analytic</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">analytic_name</span><span class="p">,</span>
        <span class="n">analytic_session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">worker</span><span class="o">=</span><span class="s2">"default"</span><span class="p">,</span>
        <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">login</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">watch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">stream_status</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Asynchronously run an analytic.</span>

<span class="sd">        Parameters:</span>

<span class="sd">          * **analytic_name: str**</span>

<span class="sd">            The full analytic class name.</span>

<span class="sd">          * **analytic_session_id: str, default=None**</span>

<span class="sd">            optional</span>

<span class="sd">            This value will be stored in Elasticsearch to mark the documents changed by this analytic session.</span>
<span class="sd">            If a value is not defined, the context object's ``analytic_session_id`` value will be automatically assigned.</span>

<span class="sd">          * **parameters: dict, default={}**</span>

<span class="sd">            optional</span>

<span class="sd">            This value corresponds to the parameters of the yaada analytic being run.</span>

<span class="sd">            The parameters are assigned by setting each key in this dict to a string</span>
<span class="sd">            of the name of a parameter. The parameter will be assinged to the value given in the key-value pair.</span>

<span class="sd">          * **worker:str, default='default**</span>

<span class="sd">            optional</span>

<span class="sd">            Use for selecting which analytic worker to use for execution</span>

<span class="sd">            Advanced Usage, Experimental API subject to change, not recommended for users</span>

<span class="sd">          * **watch:bool, default=False**</span>

<span class="sd">            optional</span>

<span class="sd">            Advanced Usage, Experimental API subject to change, not recommended for users</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">analytic_session_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">analytic_session_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">stream_status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">subscribe_analytic_status</span><span class="p">(</span>
                <span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span>
            <span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">async_exec_analytic</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="p">,</span>
            <span class="n">analytic_name</span><span class="p">,</span>
            <span class="n">analytic_session_id</span><span class="p">,</span>
            <span class="n">parameters</span><span class="p">,</span>
            <span class="n">worker</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
            <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
            <span class="n">login</span><span class="o">=</span><span class="n">login</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">gen</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">doc</span>
                    <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"finished"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"error"</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="n">context</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">unsubscribe_analytic_status</span><span class="p">(</span>
                            <span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span>
                        <span class="p">)</span>
                        <span class="n">context</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
                        <span class="k">return</span>

        <span class="k">if</span> <span class="n">stream_status</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">fetch_file_to_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote_file_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span><span class="o">.</span><span class="n">fetch_file_to_temp</span><span class="p">(</span><span class="n">remote_file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_file_to_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote_file_path</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span><span class="o">.</span><span class="n">fetch_file_to_directory</span><span class="p">(</span>
            <span class="n">remote_file_path</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">,</span> <span class="n">filename</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_artifact_to_directory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">artifact_type</span><span class="p">,</span> <span class="n">cache_dir</span><span class="o">=</span><span class="s2">"/tmp/yaada/artifacts-cache"</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span><span class="o">.</span><span class="n">fetch_artifact_to_directory</span><span class="p">(</span>
            <span class="n">doc</span><span class="p">,</span> <span class="n">artifact_type</span><span class="p">,</span> <span class="n">cache_dir</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">artifact_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span><span class="o">.</span><span class="n">save_artifact</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">artifact_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_artifact_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">artifact_type</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">,</span> <span class="n">re_skip_matches</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ob_service</span><span class="o">.</span><span class="n">save_artifact_dir</span><span class="p">(</span>
            <span class="n">doc</span><span class="p">,</span> <span class="n">artifact_type</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">,</span> <span class="n">re_skip_matches</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_external_mqtt_service</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">make_external_mqtt_service</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_manager</span>

    <span class="k">def</span> <span class="nf">analytic_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">analytic</span><span class="o">.</span><span class="n">get_analytics</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">analytic</span><span class="o">.</span><span class="n">analytic_description</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">publish_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">publish_event</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subscribe_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">remove_topic_prefix</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
            <span class="n">newdoc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">doc</span><span class="p">)</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">_event_topic_base</span><span class="si">}</span><span class="s2">/"</span>
            <span class="k">if</span> <span class="n">newdoc</span><span class="p">[</span><span class="s2">"_topic"</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                <span class="n">newdoc</span><span class="p">[</span><span class="s2">"_topic"</span><span class="p">]</span> <span class="o">=</span> <span class="n">newdoc</span><span class="p">[</span><span class="s2">"_topic"</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="p">:]</span>
            <span class="k">return</span> <span class="n">newdoc</span>

        <span class="k">if</span> <span class="n">dest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">BufferedStream</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="n">remove_topic_prefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">subscribe_event</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">unsubscribe_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">unsubscribe_event</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.aggregation">
<code class="highlight language-python"><span class="n">aggregation</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Depricated, use :py:meth:<code>yaada.analytic.context.AnalyticContext.rawquery</code> instead.</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">aggregation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Depricated, use :py:meth:`yaada.analytic.context.AnalyticContext.rawquery` instead.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">rawquery</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.async_exec_analytic">
<code class="highlight language-python"><span class="n">async_exec_analytic</span><span class="p">(</span><span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{},</span> <span class="n">worker</span><span class="o">=</span><span class="s1">'default'</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">login</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stream_status</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Asynchronously run an analytic.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**analytic_name</code>
</td>
<td><p>str**</p>
<p>The full analytic class name.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**analytic_session_id</code>
</td>
<td><p>str, default=None**</p>
<p>optional</p>
<p>This value will be stored in Elasticsearch to mark the documents changed by this analytic session.
If a value is not defined, the context object's <code>analytic_session_id</code> value will be automatically assigned.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**parameters</code>
</td>
<td><p>dict, default={}**</p>
<p>optional</p>
<p>This value corresponds to the parameters of the yaada analytic being run.</p>
<p>The parameters are assigned by setting each key in this dict to a string
of the name of a parameter. The parameter will be assinged to the value given in the key-value pair.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**worker</code>
</td>
<td><p>str, default='default**</p>
<p>optional</p>
<p>Use for selecting which analytic worker to use for execution</p>
<p>Advanced Usage, Experimental API subject to change, not recommended for users</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**watch</code>
</td>
<td><p>bool, default=False**</p>
<p>optional</p>
<p>Advanced Usage, Experimental API subject to change, not recommended for users</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">async_exec_analytic</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">analytic_name</span><span class="p">,</span>
    <span class="n">analytic_session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">worker</span><span class="o">=</span><span class="s2">"default"</span><span class="p">,</span>
    <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">login</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">watch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">stream_status</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Asynchronously run an analytic.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **analytic_name: str**</span>

<span class="sd">        The full analytic class name.</span>

<span class="sd">      * **analytic_session_id: str, default=None**</span>

<span class="sd">        optional</span>

<span class="sd">        This value will be stored in Elasticsearch to mark the documents changed by this analytic session.</span>
<span class="sd">        If a value is not defined, the context object's ``analytic_session_id`` value will be automatically assigned.</span>

<span class="sd">      * **parameters: dict, default={}**</span>

<span class="sd">        optional</span>

<span class="sd">        This value corresponds to the parameters of the yaada analytic being run.</span>

<span class="sd">        The parameters are assigned by setting each key in this dict to a string</span>
<span class="sd">        of the name of a parameter. The parameter will be assinged to the value given in the key-value pair.</span>

<span class="sd">      * **worker:str, default='default**</span>

<span class="sd">        optional</span>

<span class="sd">        Use for selecting which analytic worker to use for execution</span>

<span class="sd">        Advanced Usage, Experimental API subject to change, not recommended for users</span>

<span class="sd">      * **watch:bool, default=False**</span>

<span class="sd">        optional</span>

<span class="sd">        Advanced Usage, Experimental API subject to change, not recommended for users</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">analytic_session_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">analytic_session_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">stream_status</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">subscribe_analytic_status</span><span class="p">(</span>
            <span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span>
        <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">async_exec_analytic</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="p">,</span>
        <span class="n">analytic_name</span><span class="p">,</span>
        <span class="n">analytic_session_id</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="n">worker</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span>
        <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
        <span class="n">gpu</span><span class="o">=</span><span class="n">gpu</span><span class="p">,</span>
        <span class="n">login</span><span class="o">=</span><span class="n">login</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">gen</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">doc</span>
                <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"finished"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"error"</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">unsubscribe_analytic_status</span><span class="p">(</span>
                        <span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span>
                    <span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
                    <span class="k">return</span>

    <span class="k">if</span> <span class="n">stream_status</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">status</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.delete">
<code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Delete a single document in Elasticsearch.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type of the documents to be returned.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**id</code>
</td>
<td><p>str**</p>
<p>Identifier of document in Elasticsearch.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>.. code-block:: python</p>
<pre><code>context.delete("Publication", "b0e062ac-0e84-40db-8ecd-36e1aa0e264b")
</code></pre>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Delete a single document in Elasticsearch.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        The document type of the documents to be returned.</span>

<span class="sd">      * **id: str**</span>

<span class="sd">        Identifier of document in Elasticsearch.</span>

<span class="sd">    Example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        context.delete("Publication", "b0e062ac-0e84-40db-8ecd-36e1aa0e264b")</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.delete_by_query">
<code class="highlight language-python"><span class="n">delete_by_query</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s1">'query'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'match_all'</span><span class="p">:</span> <span class="p">{}}})</span></code>
</h3>
<div class="doc doc-contents">
<p>Delete all documents that result from the a given query.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**query</code>
</td>
<td><p>dict**</p>
<p>And Elasticsearch query. Elasticsearch's documentation on querying can be found <code>here
&lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html&gt;</code>_.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>.. code-block:: python</p>
<p>context.delete_by_query("Publication", {
      'query': {
          'match': {
              '_id': '2cf0d07c-cba9-47e3-9063-5d6265e26089'
          }
      }
  })</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_by_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Delete all documents that result from the a given query.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        The document type.</span>

<span class="sd">      * **query: dict**</span>

<span class="sd">        And Elasticsearch query. Elasticsearch's documentation on querying can be found `here</span>
<span class="sd">        &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html&gt;`_.</span>

<span class="sd">    Example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      context.delete_by_query("Publication", {</span>
<span class="sd">          'query': {</span>
<span class="sd">              'match': {</span>
<span class="sd">                  '_id': '2cf0d07c-cba9-47e3-9063-5d6265e26089'</span>
<span class="sd">              }</span>
<span class="sd">          }</span>
<span class="sd">      })</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">delete_by_query</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.delete_index">
<code class="highlight language-python"><span class="n">delete_index</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">initialize_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Deletes an index in Elasticsearch.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>Documents with this <code>doc_type</code> will all be deleted.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>.. code-block:: python</p>
<p>context.delete_index("Publication")</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">initialize_index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Deletes an index in Elasticsearch.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        Documents with this ``doc_type`` will all be deleted.</span>

<span class="sd">    Example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      context.delete_index("Publication")</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">delete_index</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">initialize_index</span><span class="o">=</span><span class="n">initialize_index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.document_counts">
<code class="highlight language-python"><span class="n">document_counts</span><span class="p">()</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns an object with a breakdown of each index and the count of documents
in each index. The keys are each <code>doc_type</code>'s in Elasticsearch and the values are
the number of documents currently stored.</p>
<p>Example:</p>
<p>.. code-block:: python</p>
<pre><code>context.document_counts()
</code></pre>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">document_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns an object with a breakdown of each index and the count of documents</span>
<span class="sd">    in each index. The keys are each ``doc_type``'s in Elasticsearch and the values are</span>
<span class="sd">    the number of documents currently stored.</span>

<span class="sd">    Example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        context.document_counts()</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">document_counts</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.document_mappings">
<code class="highlight language-python"><span class="n">document_mappings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>This is a depricated method, use :py:meth:<code>yaada.analytic.context.AnalyticContext.index_field_mappings</code> instead.</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">document_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    This is a depricated method, use :py:meth:`yaada.analytic.context.AnalyticContext.index_field_mappings` instead.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">index_field_mappings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.document_type_exists">
<code class="highlight language-python"><span class="n">document_type_exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns a bool value describing whether a <code>doc_type</code>
exists.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type, this represents an Elasticsearch index.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>Example</summary>
<p>.. code-block:: python</p>
<p>context.document_type_exists("Publication")</p>
</details>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">document_type_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns a bool value describing whether a ``doc_type``</span>
<span class="sd">    exists.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type:str**</span>

<span class="sd">        The document type, this represents an Elasticsearch index.</span>

<span class="sd">    Example:</span>

<span class="sd">     .. code-block:: python</span>

<span class="sd">        context.document_type_exists("Publication")</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">document_type_exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.exists">
<code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns a bool value describing whether or not a document exists.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**id</code>
</td>
<td><p>str**</p>
<p>The unique id of the document</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p>Example</p>
<p>.. code-block:: python</p>
<p>context.exists("Publication", "f33bca95-3caa-46ac-8667-448ba4973190")</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns a bool value describing whether or not a document exists.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">          The document type.</span>
<span class="sd">      * **id: str**</span>

<span class="sd">          The unique id of the document</span>


<span class="sd">    Example</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      context.exists("Publication", "f33bca95-3caa-46ac-8667-448ba4973190")</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.get">
<code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">sentinel_key</span><span class="o">=</span><span class="s1">'_ingest_sentinel'</span><span class="p">,</span> <span class="n">sentinel_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns a document from Elasticsearch.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type of the desired document.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**id</code>
</td>
<td><p>str**</p>
<p>The identifier of a single document.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**source</code>
</td>
<td><p>list, defult=None**</p>
<p>optional</p>
<p>A list containing the fields that will be returned for the document. Must include <code>_id</code> and <code>doc_type</code>.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**source_exclude</code>
</td>
<td><p>list, default=None**</p>
<p>optional</p>
<p>A list containing the fields that will be excluded from what is returned for the document.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**source_include</code>
</td>
<td><p>list, default=None**</p>
<p>optional</p>
<p>A list containing the fields that will returned for the document.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**wait</code>
</td>
<td><p>bool, default=False**</p>
<p>optional</p>
<p>If True, this function will wait to return until the document is searchable in Elasticsearch.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**timeout</code>
</td>
<td><p>int, default=60**</p>
<p>optional</p>
<p>This specifies the maximum time to wait for the document to be searchable in Elasticsearch if the <code>wait</code> parameter is set to <code>True</code>.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**sentinel_key</code>
</td>
<td><p>str, default='_ingest_sentinel'**</p>
<p>optional</p>
<p>Advance Usage</p>
<p>Elasticsearch field that contains the <code>sentinel_value</code>. By default, there will be an <code>_ingest_sentinal</code> Elasticsearch field.</p>
<p>This parameter relates to the <code>barrier</code> concept used as a parameter in the :py:meth:<code>yaada.analytic.context.AnalyticContext.update</code> method.
If this <code>get</code> method is being used to retrieve a document in Elasticsearch soon after it has been ingested, this can be used to wait until
that value is searchable in Elasticsearch before it is retrieved. This parameter will only be applied if the <code>wait</code> parameter
is set to <code>True</code>.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**sentinel_value</code>
</td>
<td><p>str, default=None**</p>
<p>optional</p>
<p>Advance Usage</p>
<p>This parameter is used to ensure that an updated document has fully updated in Elasticsearch before it is retrieved by the <code>get</code> method. Because a
document that is being updated may already exist, YAADA needs a way to know that it has been updated before retrieving the document.
This is done by introducing a new value to the document, called a sentinal value. If a value is specified for this parameter, YAADA will
check that this value matches up with the value in the <code>sentinel_key</code> field for the document before retrieving it, to know that it has been updated.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p>.. code-block:: python</p>
<p>context.get("Publication", "2cf0d07c-cba9-47e3-9063-5d6265e26089")</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">doc_type</span><span class="p">,</span>
    <span class="nb">id</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">source_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">source_include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">sentinel_key</span><span class="o">=</span><span class="s2">"_ingest_sentinel"</span><span class="p">,</span>
    <span class="n">sentinel_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns a document from Elasticsearch.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        The document type of the desired document.</span>

<span class="sd">      * **id: str**</span>

<span class="sd">        The identifier of a single document.</span>

<span class="sd">      * **source: list, defult=None**</span>

<span class="sd">        optional</span>

<span class="sd">        A list containing the fields that will be returned for the document. Must include ``_id`` and ``doc_type``.</span>

<span class="sd">      * **source_exclude:list, default=None**</span>

<span class="sd">        optional</span>

<span class="sd">        A list containing the fields that will be excluded from what is returned for the document.</span>

<span class="sd">      * **source_include:list, default=None**</span>

<span class="sd">        optional</span>

<span class="sd">        A list containing the fields that will returned for the document.</span>

<span class="sd">      * **wait:bool, default=False**</span>

<span class="sd">        optional</span>


<span class="sd">        If True, this function will wait to return until the document is searchable in Elasticsearch.</span>

<span class="sd">      * **timeout:int, default=60**</span>

<span class="sd">        optional</span>

<span class="sd">        This specifies the maximum time to wait for the document to be searchable in Elasticsearch if the ``wait`` parameter is set to ``True``.</span>

<span class="sd">      * **sentinel_key:str, default='_ingest_sentinel'**</span>

<span class="sd">        optional</span>

<span class="sd">        Advance Usage</span>

<span class="sd">        Elasticsearch field that contains the ``sentinel_value``. By default, there will be an ``_ingest_sentinal`` Elasticsearch field.</span>


<span class="sd">        This parameter relates to the ``barrier`` concept used as a parameter in the :py:meth:`yaada.analytic.context.AnalyticContext.update` method.</span>
<span class="sd">        If this ``get`` method is being used to retrieve a document in Elasticsearch soon after it has been ingested, this can be used to wait until</span>
<span class="sd">        that value is searchable in Elasticsearch before it is retrieved. This parameter will only be applied if the ``wait`` parameter</span>
<span class="sd">        is set to ``True``.</span>

<span class="sd">      * **sentinel_value:str, default=None**</span>

<span class="sd">        optional</span>

<span class="sd">        Advance Usage</span>

<span class="sd">        This parameter is used to ensure that an updated document has fully updated in Elasticsearch before it is retrieved by the ``get`` method. Because a</span>
<span class="sd">        document that is being updated may already exist, YAADA needs a way to know that it has been updated before retrieving the document.</span>
<span class="sd">        This is done by introducing a new value to the document, called a sentinal value. If a value is specified for this parameter, YAADA will</span>
<span class="sd">        check that this value matches up with the value in the ``sentinel_key`` field for the document before retrieving it, to know that it has been updated.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      context.get("Publication", "2cf0d07c-cba9-47e3-9063-5d6265e26089")</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ingest_barrier</span><span class="p">(</span>
            <span class="n">doc_type</span><span class="p">,</span>
            <span class="nb">id</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">sentinel_key</span><span class="o">=</span><span class="n">sentinel_key</span><span class="p">,</span>
            <span class="n">sentinel_value</span><span class="o">=</span><span class="n">sentinel_value</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">doc_type</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">_source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
        <span class="n">_source_exclude</span><span class="o">=</span><span class="n">source_exclude</span><span class="p">,</span>
        <span class="n">_source_include</span><span class="o">=</span><span class="n">source_include</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.index_field_mappings">
<code class="highlight language-python"><span class="n">index_field_mappings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns the Elasticsearch mapping for the given <code>doc_type</code>. The Elasticsearch documentation
has a section on <code>mappings. &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html&gt;</code>_</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type, this represents an Elasticsearch index.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**fields</code>
</td>
<td><p>str **</p>
<p>optional</p>
<p>Limits the mapping to fields given for this parameter. Wildcards can be used.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">index_field_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">):</span>
    <span class="c1"># Link out specific Elasticsearch call</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns the Elasticsearch mapping for the given ``doc_type``. The Elasticsearch documentation</span>
<span class="sd">    has a section on `mappings. &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html&gt;`_</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        The document type, this represents an Elasticsearch index.</span>

<span class="sd">      * **fields: str **</span>

<span class="sd">        optional</span>

<span class="sd">        Limits the mapping to fields given for this parameter. Wildcards can be used.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">index_field_mappings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.index_mappings">
<code class="highlight language-python"><span class="n">index_mappings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns raw index mapping for an Elasticsearch index. Includes Elasticsearch metadata that :py:meth:<code>yaada.analytic.context.AnalyticContext.index_field_mappings</code> does not.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type, this represents an Elasticsearch index.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">index_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns raw index mapping for an Elasticsearch index. Includes Elasticsearch metadata that :py:meth:`yaada.analytic.context.AnalyticContext.index_field_mappings` does not.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        The document type, this represents an Elasticsearch index.</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">index_mappings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.index_settings">
<code class="highlight language-python"><span class="n">index_settings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns an object with an index's Elasticsearch settings. <code>Documentation on Elasticsearch's settings &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#index-modules-settings&gt;</code>_</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type, this represents an Elasticsearch index.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">index_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns an object with an index's Elasticsearch settings. `Documentation on Elasticsearch's settings &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#index-modules-settings&gt;`_</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        The document type, this represents an Elasticsearch index.</span>


<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">index_settings</span><span class="p">(</span><span class="n">doc_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.ingest_barrier">
<code class="highlight language-python"><span class="n">ingest_barrier</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">sentinel_key</span><span class="o">=</span><span class="s1">'_ingest_sentinel'</span><span class="p">,</span> <span class="n">sentinel_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Describe sentinal key and value here so that it can be refered to.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>doc_type</code></td>
<td>
<code>[type]</code>
</td>
<td><p>[description]</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>id</code></td>
<td>
<code>[type]</code>
</td>
<td><p>[description]</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>
<code>int</code>
</td>
<td><p>[description]. Defaults to 60.</p></td>
<td>
<code>60</code>
</td>
</tr>
<tr>
<td><code>sentinel_key</code></td>
<td>
<code>str</code>
</td>
<td><p>[description]. Defaults to '_ingest_sentinel'.</p></td>
<td>
<code>'_ingest_sentinel'</code>
</td>
</tr>
<tr>
<td><code>sentinel_value</code></td>
<td>
<code>[type]</code>
</td>
<td><p>[description]. Defaults to None.</p></td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p><strong>Raises:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code><span title="yaada.core.analytic.context.IngestBarrierTimeout">IngestBarrierTimeout</span></code>
</td>
<td><p>[description]</p></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ingest_barrier</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">doc_type</span><span class="p">,</span>
    <span class="nb">id</span><span class="p">,</span>
    <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">sentinel_key</span><span class="o">=</span><span class="s2">"_ingest_sentinel"</span><span class="p">,</span>
    <span class="n">sentinel_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Describe sentinal key and value here so that it can be refered to.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc_type ([type]): [description]</span>
<span class="sd">        id ([type]): [description]</span>
<span class="sd">        timeout (int, optional): [description]. Defaults to 60.</span>
<span class="sd">        sentinel_key (str, optional): [description]. Defaults to '_ingest_sentinel'.</span>
<span class="sd">        sentinel_value ([type], optional): [description]. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        IngestBarrierTimeout: [description]</span>
<span class="sd">    """</span>
    <span class="n">delays</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">elapsed</span> <span class="o">&gt;=</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IngestBarrierTimeout</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"timeout of </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> reached and </span><span class="si">{</span><span class="n">doc_type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> not found in total of </span><span class="si">{</span><span class="n">elapsed</span><span class="si">}</span><span class="s2"> seconds"</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">delays</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">delays</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">timeout</span> <span class="o">-</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="n">delay</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">timeout</span> <span class="o">-</span> <span class="n">elapsed</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print(f"trying in {delay} seconds")</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sentinel_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentinel_present</span><span class="p">(</span>
                <span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">sentinel_key</span><span class="p">,</span> <span class="n">sentinel_value</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.mget">
<code class="highlight language-python"><span class="n">mget</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_include</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns multiple documents from Elasticsearch.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type of the documents to be returned.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**ids</code>
</td>
<td><p>list**</p>
<p>List of unique identifiers of documents in Elasticsearch</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**source</code>
</td>
<td><p>list, defult=None**</p>
<p>optional</p>
<p>A list containing the fields that will be returned for the document.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>.. code-block:: python</p>
<p>context.mget("Publication", ["2cf0d07c-cba9-47e3-9063-5d6265e26089", "b0e062ac-0e84-40db-8ecd-36e1aa0e264b"])</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mget</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_include</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns multiple documents from Elasticsearch.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        The document type of the documents to be returned.</span>

<span class="sd">      * **ids: list**</span>

<span class="sd">        List of unique identifiers of documents in Elasticsearch</span>

<span class="sd">      * **source: list, defult=None**</span>

<span class="sd">        optional</span>

<span class="sd">        A list containing the fields that will be returned for the document.</span>

<span class="sd">      * **source_exclude, default=None**</span>

<span class="sd">        optional</span>

<span class="sd">        A list containing the fields that will be excluded from what is returned for the document.</span>

<span class="sd">      * **source_include, default=None**</span>

<span class="sd">        optional</span>

<span class="sd">        A list containing the fields that will returned for the document.</span>


<span class="sd">    Example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      context.mget("Publication", ["2cf0d07c-cba9-47e3-9063-5d6265e26089", "b0e062ac-0e84-40db-8ecd-36e1aa0e264b"])</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">mget</span><span class="p">(</span>
        <span class="n">doc_type</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">,</span>
        <span class="n">_source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
        <span class="n">_source_exclude</span><span class="o">=</span><span class="n">source_exclude</span><span class="p">,</span>
        <span class="n">_source_include</span><span class="o">=</span><span class="n">source_include</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.query">
<code class="highlight language-python"><span class="n">query</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s1">'query'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'match_all'</span><span class="p">:</span> <span class="p">{}}},</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scroll_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">scroll</span><span class="o">=</span><span class="s1">'2m'</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns results of a query to Elasticsearch as a generator object. It uses an abstraction of the <code>scroll API &lt;https://www.elastic.co/guide/en/elasticsearch/reference/7.9/scroll-api.html&gt;</code>_.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>This represents an Elasticsearch index. The query will search the index.</p>
<p>Every document in Elasticsearch has a required <code>doc_type</code> field as described in the :ref:<code>Documents</code> section.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**query</code>
</td>
<td><p>dict, default={"query": {"match_all": {}}}**</p>
<p>optional</p>
<p>An Elasticsearch query. More info can be found in <code>Elasticsearch documentation.
&lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html&gt;</code>_</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**size</code>
</td>
<td><p>int, default=None**</p>
<p>optional</p>
<p>Specifies number of documents to be returned. If the value is greater than the
resulting number of documents, the resulting documents will all be returned.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**scroll_size</code>
</td>
<td><p>int, defaults=1000**</p>
<p>optional</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**scroll</code>
</td>
<td><p>str, default='2m'**</p>
<p>optional</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**raw</code>
</td>
<td><p>bool, default=False**</p>
<p>optional</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**source</code>
</td>
<td><p>list, default=None**</p>
<p>optional</p>
<p>A list of fields that will be shown for each document returned by the query. Used to limit the fields that each document will return.
Must include <code>_id</code> and <code>doc_type</code>.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">doc_type</span><span class="p">,</span>
    <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}},</span>
    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scroll_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">scroll</span><span class="o">=</span><span class="s2">"2m"</span><span class="p">,</span>
    <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns results of a query to Elasticsearch as a generator object. It uses an abstraction of the `scroll API &lt;https://www.elastic.co/guide/en/elasticsearch/reference/7.9/scroll-api.html&gt;`_.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        This represents an Elasticsearch index. The query will search the index.</span>

<span class="sd">        Every document in Elasticsearch has a required ``doc_type`` field as described in the :ref:`Documents` section.</span>

<span class="sd">      * **query: dict, default={"query": {"match_all": {}}}**</span>

<span class="sd">        optional</span>

<span class="sd">        An Elasticsearch query. More info can be found in `Elasticsearch documentation.</span>
<span class="sd">        &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html&gt;`_</span>
<span class="sd">      * **size:int, default=None**</span>

<span class="sd">        optional</span>

<span class="sd">        Specifies number of documents to be returned. If the value is greater than the</span>
<span class="sd">        resulting number of documents, the resulting documents will all be returned.</span>
<span class="sd">      * **scroll_size:int, defaults=1000**</span>

<span class="sd">        optional</span>

<span class="sd">      * **scroll:str, default='2m'**</span>

<span class="sd">        optional</span>

<span class="sd">      * **raw:bool, default=False**</span>

<span class="sd">        optional</span>

<span class="sd">      * **source:list, default=None**</span>

<span class="sd">        optional</span>

<span class="sd">        A list of fields that will be shown for each document returned by the query. Used to limit the fields that each document will return.</span>
<span class="sd">        Must include ``_id`` and ``doc_type``.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}</span>
    <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">"_source"</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
        <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scroll_size</span><span class="o">=</span><span class="n">scroll_size</span><span class="p">,</span> <span class="n">scroll</span><span class="o">=</span><span class="n">scroll</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_count_input</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">"doc_type"</span><span class="p">])</span>
        <span class="k">yield</span> <span class="n">d</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_status</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.rawquery">
<code class="highlight language-python"><span class="n">rawquery</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns results to a query.</p>
<p>This returns the bare elasticsearch results. Use this to access to the scoring information or aggregations.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type, this represents an Elasticsearch index.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**query</code>
</td>
<td><p>dict**</p>
<p>Elasticsearch query, more documentation can be found <code>here &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html&gt;</code>_.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rawquery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns results to a query.</span>

<span class="sd">    This returns the bare elasticsearch results. Use this to access to the scoring information or aggregations.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        The document type, this represents an Elasticsearch index.</span>

<span class="sd">      * **query: dict**</span>

<span class="sd">        Elasticsearch query, more documentation can be found `here &lt;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html&gt;`_.</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">rawquery</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.report_status">
<code class="highlight language-python"><span class="n">report_status</span><span class="p">(</span><span class="n">write_es</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Called automatically when analytics are started and finishing. Available to be called by Anaytic developers
to show intermediate status of a an analytic. To do this, call it in the <code>run</code> function of an Analytic.</p>
<p>Parameters:</p>
<ul>
<li>
<p><strong>write_es:bool, default=False</strong></p>
</li>
<li>
<p><strong>message:str, default=None</strong></p>
<p>A string value containing the message to display.</p>
</li>
</ul>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">report_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write_es</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Called automatically when analytics are started and finishing. Available to be called by Anaytic developers</span>
<span class="sd">    to show intermediate status of a an analytic. To do this, call it in the ``run`` function of an Analytic.</span>

<span class="sd">      Parameters:</span>

<span class="sd">      * **write_es:bool, default=False**</span>



<span class="sd">      * **message:str, default=None**</span>

<span class="sd">        A string value containing the message to display.</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"@timestamp"</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"analytic_compute_duration_seconds"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>
    <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s2">"message"</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printer</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msg_service</span><span class="o">.</span><span class="n">publish_analytic_status</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">write_es</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">write_analytic_status</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.sentinel_present">
<code class="highlight language-python"><span class="n">sentinel_present</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">sentinel_key</span><span class="p">,</span> <span class="n">sentinel_value</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>check if a document is searchable with a given sentinel value.</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sentinel_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">sentinel_key</span><span class="p">,</span> <span class="n">sentinel_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""check if a document is searchable with a given sentinel value."""</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">doc_type</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"bool"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"must"</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span><span class="s2">"term"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="nb">id</span><span class="p">}},</span>
                            <span class="p">{</span><span class="s2">"term"</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">sentinel_key</span><span class="si">}</span><span class="s2">.keyword"</span><span class="p">:</span> <span class="n">sentinel_value</span><span class="p">}},</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sentinel_key</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">doc</span><span class="p">[</span><span class="n">sentinel_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">sentinel_value</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.set_analytic_name">
<code class="highlight language-python"><span class="n">set_analytic_name</span><span class="p">(</span><span class="n">analytic_name</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Assigns an <code>analytic_name</code> value of a context object.</p>
<ul>
<li><strong>analytic_name: str</strong></li>
</ul>
<p>A description of the analytic's purpose</p>
<p>Example:</p>
<p>.. code-block:: python</p>
<pre><code>context.set_analytic_name("jupyter")
</code></pre>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_analytic_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analytic_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Assigns an ``analytic_name`` value of a context object.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    * **analytic_name: str**</span>

<span class="sd">      A description of the analytic's purpose</span>

<span class="sd">    Example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        context.set_analytic_name("jupyter")</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">analytic_name</span> <span class="o">=</span> <span class="n">analytic_name</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.set_analytic_session_id">
<code class="highlight language-python"><span class="n">set_analytic_session_id</span><span class="p">(</span><span class="n">analytic_session_id</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Assigns an <code>analytic_session_id</code> value of a context object.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**analytic_session_id</code>
</td>
<td><p>str**</p>
<p>An identifier for this analytic object</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>.. code-block:: python</p>
<pre><code>context.set_analytic_session_id("Query Data")
</code></pre>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_analytic_session_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Assigns an ``analytic_session_id`` value of a context object.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **analytic_session_id: str**</span>

<span class="sd">        An identifier for this analytic object</span>

<span class="sd">    Example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        context.set_analytic_session_id("Query Data")</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">analytic_session_id</span> <span class="o">=</span> <span class="n">analytic_session_id</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.sync_exec_analytic">
<code class="highlight language-python"><span class="n">sync_exec_analytic</span><span class="p">(</span><span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{},</span> <span class="n">include_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">printer</span><span class="o">=</span><span class="nb">print</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Synchronously run an analytic. A tutorial on writing and running yaada analytics can be found in the :ref:<code>Writing an Analytic&lt;Writing an Analytic&gt;</code> section.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**analytic_name</code>
</td>
<td><p>str**</p>
<p>The full analytic class name.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**analytic_session_id</code>
</td>
<td><p>str, default=None**</p>
<p>optional</p>
<p>This value will be stored in Elasticsearch to mark the documents changed by this analytic session.
If a value is not defined, the context object's <code>analytic_session_id</code> value will be automatically assigned.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**parameters</code>
</td>
<td><p>dict, default={}**</p>
<p>optional</p>
<p>This value corresponds to the parameters of the yaada analytic being run.</p>
<p>The parameters are assigned by setting each key in this dict to a string
of the name of a parameter. The parameter will be assinged to the value given in the key-value pair.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**include_results</code>
</td>
<td><p>bool, default=False**</p>
<p>If running an analytic synchronously, setting this to  <code>True</code> will return the produced documents from the analytic.</p>
<p>Warning - Will Produce a Large Output</p>
<p>optional</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**printer</code>
</td>
<td><p>function, default=print**</p>
<p>optional</p>
<p>Advanced Usage, Experimental API subject to change, not recommended for users</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<p>.. code-block:: python</p>
<p>context.sync_exec_analytic(
      analytic_name="yaada.analytic.builtin.newspaper.NewspaperScrapeSources",
      parameters={"content":True,"scrape_top_image":False,"memoize":True})</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sync_exec_analytic</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">analytic_name</span><span class="p">,</span>
    <span class="n">analytic_session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">include_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">printer</span><span class="o">=</span><span class="nb">print</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Synchronously run an analytic. A tutorial on writing and running yaada analytics can be found in the :ref:`Writing an Analytic&lt;Writing an Analytic&gt;` section.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **analytic_name: str**</span>

<span class="sd">        The full analytic class name.</span>

<span class="sd">      * **analytic_session_id: str, default=None**</span>

<span class="sd">        optional</span>

<span class="sd">        This value will be stored in Elasticsearch to mark the documents changed by this analytic session.</span>
<span class="sd">        If a value is not defined, the context object's ``analytic_session_id`` value will be automatically assigned.</span>

<span class="sd">      * **parameters: dict, default={}**</span>

<span class="sd">        optional</span>

<span class="sd">        This value corresponds to the parameters of the yaada analytic being run.</span>

<span class="sd">        The parameters are assigned by setting each key in this dict to a string</span>
<span class="sd">        of the name of a parameter. The parameter will be assinged to the value given in the key-value pair.</span>

<span class="sd">      * **include_results: bool, default=False**</span>

<span class="sd">        If running an analytic synchronously, setting this to  ``True`` will return the produced documents from the analytic.</span>

<span class="sd">        Warning - Will Produce a Large Output</span>

<span class="sd">        optional</span>

<span class="sd">      * **printer: function, default=print**</span>

<span class="sd">        optional</span>

<span class="sd">        Advanced Usage, Experimental API subject to change, not recommended for users</span>

<span class="sd">    Example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      context.sync_exec_analytic(</span>
<span class="sd">          analytic_name="yaada.analytic.builtin.newspaper.NewspaperScrapeSources",</span>
<span class="sd">          parameters={"content":True,"scrape_top_image":False,"memoize":True})</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">analytic_session_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">analytic_session_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_derived_context</span><span class="p">(</span><span class="n">analytic_name</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sync_exec_analytic</span><span class="p">(</span>
        <span class="n">c</span><span class="p">,</span>
        <span class="n">analytic_name</span><span class="p">,</span>
        <span class="n">analytic_session_id</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="n">include_results</span><span class="o">=</span><span class="n">include_results</span><span class="p">,</span>
        <span class="n">printer</span><span class="o">=</span><span class="n">printer</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.term_counts">
<code class="highlight language-python"><span class="n">term_counts</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s1">'query'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'match_all'</span><span class="p">:</span> <span class="p">{}}})</span></code>
</h3>
<div class="doc doc-contents">
<p>Returns an object describing the frequency of terms for a given field of an index by running an Elasticsearch terms aggregation.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>
<code>**doc_type</code>
</td>
<td><p>str**</p>
<p>The document type, this represents an Elasticsearch index.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**term</code>
</td>
<td><p>str**</p>
<p>The field that will be inspected.</p></td>
<td>
<em>required</em>
</td>
</tr>
<tr>
<td><code>*</code></td>
<td>
<code>**query</code>
</td>
<td><p>dict, default={"query":{"match_all":{}}}**</p>
<p>optional</p>
<p>Provides a filter for the documents that will be aggregated.</p></td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">term_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_type</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">"query"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"match_all"</span><span class="p">:</span> <span class="p">{}}}):</span>
<span class="w">    </span><span class="sd">"""</span>

<span class="sd">    Returns an object describing the frequency of terms for a given field of an index by running an Elasticsearch terms aggregation.</span>

<span class="sd">    Parameters:</span>

<span class="sd">      * **doc_type: str**</span>

<span class="sd">        The document type, this represents an Elasticsearch index.</span>

<span class="sd">      * **term: str**</span>

<span class="sd">        The field that will be inspected.</span>

<span class="sd">      * **query: dict, default={"query":{"match_all":{}}}**</span>

<span class="sd">        optional</span>

<span class="sd">        Provides a filter for the documents that will be aggregated.</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_service</span><span class="o">.</span><span class="n">term_counts</span><span class="p">(</span><span class="n">doc_type</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="yaada.core.analytic.context.AnalyticContext.update">
<code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">barrier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">barrier_timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">raise_ingest_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Stores the document given by the <code>doc</code> parameter in Elasticsearch.</p>
<p>Parameters:</p>
<ul>
<li>
<p><strong>doc: dict, list[dict]</strong></p>
<p>The <code>doc</code> parameter, represents an Elasticsearch document to be ingested. The schema and details of a document can be found in :ref:<code>Documents</code>.</p>
<p>This parameter can be given as a dictionary representation of an Elasticsearch document, or a list of <code>doc</code>'s which will result in a batch-ingest.</p>
</li>
<li>
<p><strong>process: bool, default = True</strong></p>
<p>optional</p>
<p>If <code>True</code>, the update process with run through the ingest pipeline</p>
</li>
<li>
<p><strong>sync: bool, default = True</strong></p>
<p>optional</p>
<p>If value is set to <code>True</code>, the process will be run synchronously, if set to <code>False</code>, it will run asynchronously.</p>
</li>
<li>
<p><strong>archive: bool, default = False</strong></p>
<p>optional</p>
<p>If the document or documents being ingested are from an archive, this parameter's value should be set
to <code>True</code>. Otherwise, it will default to <code>False</code>.</p>
<p>When <code>False</code>, a document being ingested through the <code>update</code> function will be automtically set a timestamp value
to the field <code>@timestamp</code> to the same time that it was ingested. When <code>True</code>, because the document is from an archive,
the <code>@timestamp</code> field will already exists and will not be reassigned. Therefore, it will keep it's value representing the time
when it was originally ingested.</p>
</li>
<li>
<p><strong>barrier: bool, default=False</strong></p>
<p>optional</p>
<p>Setting <code>barrier</code> to <code>True</code> ensures that the document is indexed Elasticsearch
and searchable before the the update function finishes running.</p>
<p>Enabling <code>barrier</code> will dractically reduce throughput performace especially if <code>update</code>
is being called repeatedly by updating one document at a time. The process will not be slowed
drastically if the <code>update</code> is run as a batch-ingest.</p>
</li>
<li>
<p><strong>barrier_timeout: int, default=600</strong></p>
<p>optional</p>
<p>This value is the maximum amount of time in seconds that the function will wait
for the document to appear in Elasticsearch before finishing. If this maximum value
is reached and the document is not in elastic search, it will return an
<code>IngestBarrierTimeout</code> error. This only applies if the <code>barrier</code> parameter is set
to <code>True</code>.</p>
</li>
<li>
<p><strong>raise_ingest_error: bool, default=True</strong></p>
<p>optional</p>
</li>
</ul>
<p>Short example:</p>
<p>.. code-block:: python</p>
<p>doc = {
      _id = "123",
      doc_type = "EmployeeSurvey",
      favorite_color = "red",
      favoite_number = 4
  }
  context.update(doc)</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">doc</span><span class="p">,</span>
    <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">archive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">barrier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">barrier_timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">raise_ingest_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>

<span class="sd">    Stores the document given by the ``doc`` parameter in Elasticsearch.</span>

<span class="sd">      Parameters:</span>

<span class="sd">      * **doc: dict, list[dict]**</span>

<span class="sd">        The ``doc`` parameter, represents an Elasticsearch document to be ingested. The schema and details of a document can be found in :ref:`Documents`.</span>

<span class="sd">        This parameter can be given as a dictionary representation of an Elasticsearch document, or a list of ``doc``'s which will result in a batch-ingest.</span>

<span class="sd">      * **process: bool, default = True**</span>

<span class="sd">        optional</span>

<span class="sd">        If ``True``, the update process with run through the ingest pipeline</span>

<span class="sd">      * **sync: bool, default = True**</span>

<span class="sd">        optional</span>

<span class="sd">        If value is set to ``True``, the process will be run synchronously, if set to ``False``, it will run asynchronously.</span>

<span class="sd">      * **archive: bool, default = False**</span>

<span class="sd">        optional</span>

<span class="sd">        If the document or documents being ingested are from an archive, this parameter's value should be set</span>
<span class="sd">        to ``True``. Otherwise, it will default to ``False``.</span>

<span class="sd">        When ``False``, a document being ingested through the ``update`` function will be automtically set a timestamp value</span>
<span class="sd">        to the field ``@timestamp`` to the same time that it was ingested. When ``True``, because the document is from an archive,</span>
<span class="sd">        the ``@timestamp`` field will already exists and will not be reassigned. Therefore, it will keep it's value representing the time</span>
<span class="sd">        when it was originally ingested.</span>

<span class="sd">      * **barrier: bool, default=False**</span>

<span class="sd">        optional</span>

<span class="sd">        Setting ``barrier`` to ``True`` ensures that the document is indexed Elasticsearch</span>
<span class="sd">        and searchable before the the update function finishes running.</span>

<span class="sd">        Enabling ``barrier`` will dractically reduce throughput performace especially if ``update``</span>
<span class="sd">        is being called repeatedly by updating one document at a time. The process will not be slowed</span>
<span class="sd">        drastically if the ``update`` is run as a batch-ingest.</span>

<span class="sd">      * **barrier_timeout: int, default=600**</span>

<span class="sd">        optional</span>

<span class="sd">        This value is the maximum amount of time in seconds that the function will wait</span>
<span class="sd">        for the document to appear in Elasticsearch before finishing. If this maximum value</span>
<span class="sd">        is reached and the document is not in elastic search, it will return an</span>
<span class="sd">        ``IngestBarrierTimeout`` error. This only applies if the ``barrier`` parameter is set</span>
<span class="sd">        to ``True``.</span>

<span class="sd">      * **raise_ingest_error: bool, default=True**</span>

<span class="sd">        optional</span>


<span class="sd">    Short example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      doc = {</span>
<span class="sd">          _id = "123",</span>
<span class="sd">          doc_type = "EmployeeSurvey",</span>
<span class="sd">          favorite_color = "red",</span>
<span class="sd">          favoite_number = 4</span>
<span class="sd">      }</span>
<span class="sd">      context.update(doc)</span>


<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">(</span>
        <span class="n">doc</span><span class="p">,</span>
        <span class="n">process</span><span class="o">=</span><span class="n">process</span><span class="p">,</span>
        <span class="n">sync</span><span class="o">=</span><span class="n">sync</span><span class="p">,</span>
        <span class="n">upsert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">archive</span><span class="o">=</span><span class="n">archive</span><span class="p">,</span>
        <span class="n">barrier</span><span class="o">=</span><span class="n">barrier</span><span class="p">,</span>
        <span class="n">barrier_timeout</span><span class="o">=</span><span class="n">barrier_timeout</span><span class="p">,</span>
        <span class="n">raise_ingest_error</span><span class="o">=</span><span class="n">raise_ingest_error</span><span class="p">,</span>
        <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="yaada.core.analytic.context.make_analytic_context">
<code class="highlight language-python"><span class="n">make_analytic_context</span><span class="p">(</span><span class="n">analytic_name</span><span class="o">=</span><span class="s1">'anonymous'</span><span class="p">,</span> <span class="n">analytic_session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{},</span> <span class="n">msg_service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc_service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ob_service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init_pipelines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_analytics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_models</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">schema_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connect_to_services</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="p">{})</span></code>
</h2>
<div class="doc doc-contents">
<p>Return an instance of the context object. A context object is needed to
interact with the Elasticsearch database using python. A detailed description of the
context object can be found in the :ref:<code>Context Object&lt;Context Object&gt;</code> section.</p>
<ul>
<li><strong>analytic_name: str, default='anonymous'</strong></li>
</ul>
<p>A string describing the reason for this context object's instantiation.
  This value will mark documents created and edited by this instance of the context object</p>
<p>When running an analytic, this value will automatically get set to the analytic's class name.</p>
<p>This value will be stored in a document's <code>analytic_name</code> field.</p>
<ul>
<li><strong>analytic_session_id: str, default=None</strong></li>
</ul>
<p>optional</p>
<p>This value will be saved in Elasticsearch. It will mark which documents are edited by this specific instance of the
  context object.
  Documents added or edited by a context, will inherit that context's <code>analytic_session_id</code> in a <code>analytic_session_id</code> field.</p>
<p>If no value is given, a universally unique identifier will be automatically assigned.</p>
<ul>
<li><strong>parameters:dict, default={}</strong></li>
</ul>
<p>private
* <strong>msg_service=None</strong></p>
<p>private
* <strong>doc_service=None</strong></p>
<p>private
* <strong>ob_service=None</strong></p>
<p>private
* <strong>model_manager=None</strong></p>
<ul>
<li><strong>init_pipelines=True</strong></li>
</ul>
<p>optional</p>
<p>When <code>True</code>, the creation of the context object will initialize the pipelines. The pipeline needs to be initialized for
  asynchronous processes.</p>
<p>The only downside to initializing the pipeline when it is not necessary is that it will take a little longer to create the context object.
* <strong>config=None</strong></p>
<p>private
* <strong>schema_manager=None</strong></p>
<p>private
* <strong>overrides={}</strong></p>
<p>optional</p>
<p>Allows an override to environment variables and settings in a service.</p>
<p>Here is an example of what is needed to get started using the <code>context object</code></p>
<p>.. code-block:: python</p>
<p>from yaada.analytic.context import make_analytic_context
  context = make_analytic_context()</p>
<details class="quote">
<summary>Source code in <code>/Users/ganberg/dev/git/yaada-github/src/core/yaada/core/analytic/context.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_analytic_context</span><span class="p">(</span>
    <span class="n">analytic_name</span><span class="o">=</span><span class="s2">"anonymous"</span><span class="p">,</span>
    <span class="n">analytic_session_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">msg_service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">doc_service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ob_service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">model_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">init_pipelines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">init_analytics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">init_models</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">schema_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">connect_to_services</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">overrides</span><span class="o">=</span><span class="p">{},</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return an instance of the context object. A context object is needed to</span>
<span class="sd">    interact with the Elasticsearch database using python. A detailed description of the</span>
<span class="sd">    context object can be found in the :ref:`Context Object&lt;Context Object&gt;` section.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    * **analytic_name: str, default='anonymous'**</span>

<span class="sd">      A string describing the reason for this context object's instantiation.</span>
<span class="sd">      This value will mark documents created and edited by this instance of the context object</span>

<span class="sd">      When running an analytic, this value will automatically get set to the analytic's class name.</span>

<span class="sd">      This value will be stored in a document's ``analytic_name`` field.</span>

<span class="sd">    * **analytic_session_id: str, default=None**</span>

<span class="sd">      optional</span>

<span class="sd">      This value will be saved in Elasticsearch. It will mark which documents are edited by this specific instance of the</span>
<span class="sd">      context object.</span>
<span class="sd">      Documents added or edited by a context, will inherit that context's ``analytic_session_id`` in a ``analytic_session_id`` field.</span>

<span class="sd">      If no value is given, a universally unique identifier will be automatically assigned.</span>

<span class="sd">    * **parameters:dict, default={}**</span>

<span class="sd">      private</span>
<span class="sd">    * **msg_service=None**</span>

<span class="sd">      private</span>
<span class="sd">    * **doc_service=None**</span>

<span class="sd">      private</span>
<span class="sd">    * **ob_service=None**</span>

<span class="sd">      private</span>
<span class="sd">    * **model_manager=None**</span>

<span class="sd">    * **init_pipelines=True**</span>

<span class="sd">      optional</span>

<span class="sd">      When ``True``, the creation of the context object will initialize the pipelines. The pipeline needs to be initialized for</span>
<span class="sd">      asynchronous processes.</span>

<span class="sd">      The only downside to initializing the pipeline when it is not necessary is that it will take a little longer to create the context object.</span>
<span class="sd">    * **config=None**</span>

<span class="sd">      private</span>
<span class="sd">    * **schema_manager=None**</span>

<span class="sd">      private</span>
<span class="sd">    * **overrides={}**</span>

<span class="sd">      optional</span>

<span class="sd">      Allows an override to environment variables and settings in a service.</span>

<span class="sd">    Here is an example of what is needed to get started using the ``context object``</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      from yaada.analytic.context import make_analytic_context</span>
<span class="sd">      context = make_analytic_context()</span>


<span class="sd">    """</span>
    <span class="n">start_t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">analytic_session_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">analytic_session_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

    <span class="n">context</span> <span class="o">=</span> <span class="n">AnalyticContext</span><span class="p">(</span>
        <span class="n">analytic_name</span><span class="p">,</span>
        <span class="n">analytic_session_id</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="n">msg_service</span><span class="o">=</span><span class="n">msg_service</span><span class="p">,</span>
        <span class="n">doc_service</span><span class="o">=</span><span class="n">doc_service</span><span class="p">,</span>
        <span class="n">ob_service</span><span class="o">=</span><span class="n">ob_service</span><span class="p">,</span>
        <span class="n">model_manager</span><span class="o">=</span><span class="n">model_manager</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
        <span class="n">schema_manager</span><span class="o">=</span><span class="n">schema_manager</span><span class="p">,</span>
        <span class="n">connect_to_services</span><span class="o">=</span><span class="n">connect_to_services</span><span class="p">,</span>
        <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">analytic</span><span class="o">.</span><span class="n">find_and_register</span><span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">init_analytics</span><span class="p">,</span> <span class="n">init_pipelines</span><span class="p">,</span> <span class="n">init_models</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">init_pipelines</span><span class="p">:</span>
        <span class="n">context</span><span class="o">.</span><span class="n">init_pipeline</span><span class="p">()</span>

    <span class="n">end_t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"##context creation took </span><span class="si">{</span><span class="n">end_t</span><span class="o">-</span><span class="n">start_t</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Aptima, Inc. 2023
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.51198bba.min.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>